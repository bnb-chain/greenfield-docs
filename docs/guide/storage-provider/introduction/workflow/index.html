<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guide/storage-provider/introduction/workflow">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">SP Workflow | BNB Greenfield</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.bnbchain.org/greenfield-docs/docs/guide/storage-provider/introduction/workflow/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="decentralized storage, blockchain storage solution"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="SP Workflow | BNB Greenfield"><meta data-rh="true" name="description" content="This section will combine all the current and existing workflows of SP to help you understand how SP works and how internal state flows."><meta data-rh="true" property="og:description" content="This section will combine all the current and existing workflows of SP to help you understand how SP works and how internal state flows."><link data-rh="true" rel="icon" href="/greenfield-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.bnbchain.org/greenfield-docs/docs/guide/storage-provider/introduction/workflow/"><link data-rh="true" rel="alternate" href="https://docs.bnbchain.org/greenfield-docs/docs/guide/storage-provider/introduction/workflow/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.bnbchain.org/greenfield-docs/docs/guide/storage-provider/introduction/workflow/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3LF005YNGZ-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/greenfield-docs/blog/rss.xml" title="BNB Greenfield RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/greenfield-docs/blog/atom.xml" title="BNB Greenfield Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LSRFL0KHRR"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-LSRFL0KHRR",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="BNB Greenfield" href="/greenfield-docs/opensearch.xml"><link rel="stylesheet" href="/greenfield-docs/assets/css/styles.52c35f0a.css">
<link rel="preload" href="/greenfield-docs/assets/js/runtime~main.a785cd8e.js" as="script">
<link rel="preload" href="/greenfield-docs/assets/js/main.3f1a059a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/greenfield-docs/"><div class="navbar__logo"><img src="/greenfield-docs/img/logo.svg" alt="Greenfield Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/greenfield-docs/img/logo.svg" alt="Greenfield Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">BNB Greenfield</b></a><a class="navbar__item navbar__link" href="/greenfield-docs/docs/guide/introduction/overview/">Guide</a><a class="navbar__item navbar__link" href="/greenfield-docs/docs/tutorials/overview/">Tutorials</a><a class="navbar__item navbar__link" href="/greenfield-docs/docs/api/endpoints/">API &amp; SDK</a><a class="navbar__item navbar__link" href="/greenfield-docs/docs/release-notes/releaseNotes/">Releases</a><a class="navbar__item navbar__link" href="/greenfield-docs/docs/faq/greenfield-faqs/">FAQs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/bnb-chain/greenfield-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/greenfield-docs/docs/guide/home/">Introduction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/greenfield-docs/docs/guide/getting-started/overview/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/greenfield-docs/docs/guide/core-concept/accounts/">Core Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/greenfield-docs/docs/guide/greenfield-blockchain/overview/">Greenfield Blockchain</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/greenfield-docs/docs/guide/storage-provider/introduction/overview/">Storage Provider</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/greenfield-docs/docs/guide/storage-provider/introduction/overview/">Overview</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/greenfield-docs/docs/guide/storage-provider/introduction/overview/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/greenfield-docs/docs/guide/storage-provider/introduction/workflow/">SP Workflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/greenfield-docs/docs/guide/storage-provider/introduction/standard/">The Greenfield Storage Provider Standard</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/greenfield-docs/docs/guide/storage-provider/modules/gateway/">Modules</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/greenfield-docs/docs/guide/storage-provider/run-book/compile-dependences/">Run Storage Provider</a></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/greenfield-docs/docs/contribute/">Contribute</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a href="https://github.com/bnb-chain/greenfield-whitepaper" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK">Whitepaper<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_BDYx"><div class="docItemContainer_oq1c"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/greenfield-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Storage Provider</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Overview</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">SP Workflow</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="row"><div class="col col--12"><h1>SP Workflow</h1><p>This section will combine all the current and existing workflows of SP to help you understand how SP works and how internal state flows.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="get-approval">Get Approval<a class="hash-link" href="#get-approval" title="Direct link to heading">​</a></h2><p><a href="/greenfield-docs/docs/api/storage-provider-rest/get_approval/">GetApproval</a> API includes actions: <code>CreateBucket</code> and <code>CreateObject</code>. To upload an object into SP, you must first send a CreateBucket approval request, which will create a bucket on the Greenfield blockchain. If the request is successful, you can then send a CreateObject approval request. Both of these actions are used to determine whether SP is willing to serve the request. SP may reject users with a bad reputation or specific objects or buckets. SP approves the request by signing a message for the action and responding to the users. By default, SP will serve the request, but it can refuse if it chooses to do so. Each SP can customize its own strategy for accepting or rejecting requests.</p><p>The flow chart is shown below:</p><div align="center"><img loading="lazy" src="https://raw.githubusercontent.com/bnb-chain/greenfield-docs/main/static/asset/07-get_approval.jpg" width="1000" height="100" class="img_ev3q"></div><ul><li>Gateway receives GetApproval requests from the request originator.</li><li>Gateway verifies the signature of request to ensure that the request has not been tampered with.</li><li>Gateway invokes Authenticator to check the authorization to ensure the corresponding account is existed.</li><li>Gateway invokes Approver to fills the CreateBucket/CreateObject message timeout field and dispatches the request to Signer service.</li><li>Gets Signature from Signer, fills the message&#x27;s approval signature field, and returns to the request originator.</li></ul><p><strong>Note</strong></p><p>By default, each account can create a maximum of 100 buckets.</p><p>If users send multiple <code>CreateBucket</code> or <code>CreateObject</code> approval requests in a short period of time, SP will provide the same results due to an expired blockchain height that is set to prevent repeated requests, such as DDoS attacks.</p><p>See request and response details for this API: <a href="/greenfield-docs/docs/api/storage-provider-rest/get_approval/">GetApproval</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upload-object">Upload Object<a class="hash-link" href="#upload-object" title="Direct link to heading">​</a></h2><p>After successfully sending requests to the <a href="https://greenfield.bnbchain.org/docs/api-sdk/storage-provider-rest/get_approval.html" target="_blank" rel="noopener noreferrer">GetApproval</a> API and receiving results, you can upload an object to SP. This API involves two steps: first, users manually upload an object to PrimarySP; second, after a successful upload to PrimarySP, the object is automatically replicated to secondarySP to ensure data reliability.</p><p>Upload to PrimarySP flow chart is shown below:</p><div align="center"><img loading="lazy" src="https://raw.githubusercontent.com/bnb-chain/greenfield-docs/main/static/asset/08-put_object.jpg" width="1000" height="100" class="img_ev3q"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gateway"><a href="/greenfield-docs/docs/guide/storage-provider/modules/gateway/">Gateway</a><a class="hash-link" href="#gateway" title="Direct link to heading">​</a></h3><ul><li>Gateway receives PutObject requests from client.</li><li>Gateway verifies the signature of request to ensure that the request has not been tampered with.</li><li>Gateway invokes Authenticator to check the authorization to ensure the corresponding account has permissions on resources.</li><li>Dispatches the request to Uploader module.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="uploader"><a href="/greenfield-docs/docs/guide/storage-provider/modules/uploader/">Uploader</a><a class="hash-link" href="#uploader" title="Direct link to heading">​</a></h3><ul><li>Uploader accepts object data in a streaming format and divides it into segments based on the <code>MaxSegmentSize</code>, which is determined by consensus in the Greenfield chain. The segmented data is then stored in the PieceStore.</li><li>Uploader creates a TaskContext with an initial state of <code>INIT_UNSPECIFIED</code>. Upon beginning the upload of segments, the TaskContext&#x27;s state transitions to <code>UPLOAD_OBJECT_DOING</code>. Once all segments have been uploaded, the TaskContext&#x27;s state changes to <code>UPLOAD_OBJECT_DONE</code>. In the event of any abnormal situations during the upload, the TaskContext&#x27;s state will change to <code>UPLOAD_OBJECT_ERROR</code>.</li><li>After uploading all segments, insert segments data checksums and root checksum into the SP DB.</li><li>Uploader creates an upload object task for Manager and returns a success message to the client indicating that the put object request is successful.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="taskexecutor"><a href="/greenfield-docs/docs/guide/storage-provider/modules/taskexecutor/">TaskExecutor</a><a class="hash-link" href="#taskexecutor" title="Direct link to heading">​</a></h3><p>Replicate to SecondarySP flow chart is shown below:</p><div align="center"><img loading="lazy" src="https://raw.githubusercontent.com/bnb-chain/greenfield-docs/main/static/asset/09-replicate_object.jpg" width="1000" height="100" class="img_ev3q"></div><ul><li>Executor fetch ReplicatePieceTask from the Manager which help pick a proper virtual group.</li><li>The object data is asynchronously replicated to virtual group secondary SPs.</li><li>TaskExecutor retrieves segments from the PieceStore in parallel and uses <code>Erasure Coding(EC)</code> to compute a data redundancy solution for these segments, generating the corresponding EC pieces. The EC pieces are then organized into six replicate data groups, with each group containing several EC pieces based on the Redundancy policy.</li><li>Then sends the replicate data groups in streaming to the selected secondary SPs in parallel.</li><li>The TaskContext&#x27;s secondary SP information is updated once the replication of a secondary SP is completed. The TaskContext&#x27;s state changes from <code>REPLICATE_OBJECT_DOING</code> to <code>REPLICATE_OBJECT_DONE</code> only after all secondary SPs have completed replication.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="receiver"><a href="/greenfield-docs/docs/guide/storage-provider/modules/receiver/">Receiver</a><a class="hash-link" href="#receiver" title="Direct link to heading">​</a></h3><ul><li>Receiver checks whether the SecondarySP approval is self-signed and has timed out. If either of these conditions is true, the system returns a <code>SIGNATURE_ERROR</code> to TaskExecutor.</li><li>Receiver works in secondary SP, receives EC pieces that belong to the same replicate data group, and uploads the EC pieces to the secondary SP PieceStore.</li><li>Computes the EC pieces integrity checksum, sign the integrity checksum by SP&#x27;s approval private key, then returns these to TaskExecutor.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="taskexecutor-1"><a href="/greenfield-docs/docs/guide/storage-provider/modules/taskexecutor/">TaskExecutor</a><a class="hash-link" href="#taskexecutor-1" title="Direct link to heading">​</a></h3><ul><li>Receives the response from secondary SPs&#x27; Receiver, and unsigned the signature to compare with the secondary SP&#x27;s approval public key.</li><li>Sends the MsgSealObject to the Signer for signing the seal object transaction and broadcasting to the Greenfield chain with the secondary SPs&#x27; integrity hash and signature. The state of the TaskContext turns to <code>SIGN_OBJECT_DOING</code> from <code>REPLICATE_OBJECT_DONE</code>. If Signer succeeds to broadcast the SealObjectTX, changes <code>SEAL_OBJECT_TX_DOING</code> state immediately into <code>SIGN_OBJECT_DONE</code> state.</li><li>Monitor the execution results of seal object transaction on the Greenfield chain to determine whether the seal is successful. If so, the TaskContext state is changed into <code>SEAL_OBJECT_DONE</code> state.</li></ul><p>See request and response details for this API: <a href="/greenfield-docs/docs/api/storage-provider-rest/put_object/">PutObject</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="download-object">Download Object<a class="hash-link" href="#download-object" title="Direct link to heading">​</a></h2><p>Users can download an object from PrimarySP. The flow chart is shown below:</p><div align="center"><img loading="lazy" src="https://raw.githubusercontent.com/bnb-chain/greenfield-docs/main/static/asset/10-get_object.jpg" width="1000" height="100" class="img_ev3q"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-1"><a href="/greenfield-docs/docs/guide/storage-provider/modules/gateway/">Gateway</a><a class="hash-link" href="#gateway-1" title="Direct link to heading">​</a></h3><ul><li>Receives the GetObject request from the client.</li><li>Verifies the signature of request to ensure that the request has not been tampered with.</li><li>Checks the authorization to ensure the corresponding account has permissions on resources.</li><li>Checks the object state and payment account state to ensure the object is uploaded in the primary SP, and the payment account is active.</li><li>Dispatches the request to Downloader.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="downloader"><a href="/greenfield-docs/docs/guide/storage-provider/modules/downloader/">Downloader</a><a class="hash-link" href="#downloader" title="Direct link to heading">​</a></h3><ul><li>Receives the GetObject request from the Gateway service.</li><li>Check whether the read traffic exceeds the quota.<ul><li>If exceeds the quota, the Downloader refuses to serve and returns a not-enough-quota error to the Gateway.</li><li>If the quota is sufficient, Downloader inserts read record into the SP traffic-db.</li></ul></li><li>Downloader splits the GetObject request into GetPiece requests (which support range reads) to retrieve the corresponding piece payload data. Downloader then streams the object payload data back to the Gateway.</li></ul><p>See request and response details for this API: <a href="/greenfield-docs/docs/api/storage-provider-rest/put_object/">GetObject</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="querymeta">QueryMeta<a class="hash-link" href="#querymeta" title="Direct link to heading">​</a></h2><p>Users maybe want to query some metadata about buckets, objects, bucket read quota or bucket read records from SP. SP provides related APIs about querying metadata. The flow chart is shown below:</p><div align="center"><img loading="lazy" src="https://raw.githubusercontent.com/bnb-chain/greenfield-docs/main/static/asset/11-query_meta.jpg" width="800" height="100" class="img_ev3q"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-2"><a href="/greenfield-docs/docs/guide/storage-provider/modules/gateway/">Gateway</a><a class="hash-link" href="#gateway-2" title="Direct link to heading">​</a></h3><ul><li>Receives the QueryMeta request from the client.</li><li>Verifies the signature of request to ensure that the request has not been tampered with.</li><li>Checks the authorization to ensure the corresponding account has permissions on resources.</li><li>Dispatches the request to Metadata.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="metadata">Metadata<a class="hash-link" href="#metadata" title="Direct link to heading">​</a></h3><ul><li>Metadata receives the QueryMeta request from Gateway.</li><li>Metadata queries bucket or object from SP DB or BS DB.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="get-challenge-piece-info">Get Challenge Piece Info<a class="hash-link" href="#get-challenge-piece-info" title="Direct link to heading">​</a></h2><p>Ensuring data integrity and availability is always the top priority for any decentralized storage network. To achieve better high availability (HA), we use data challenges instead of storage proofs. The system continuously issues data challenges to random pieces on the greenfield chain, and SP that stores the challenged piece responds using the challenge workflow. Each SP splits the object payload data into segments, stores the segment data in the PieceStore, and stores the segment checksum in SP DB.</p><p>The flow chart is shown below:</p><div align="center"><img loading="lazy" src="https://raw.githubusercontent.com/bnb-chain/greenfield-docs/main/static/asset/12-challenge.jpg" width="1000" height="100" class="img_ev3q"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-3"><a href="/greenfield-docs/docs/guide/storage-provider/modules/gateway/">Gateway</a><a class="hash-link" href="#gateway-3" title="Direct link to heading">​</a></h3><ul><li>Receives the Challenge request from the client.</li><li>Verifies the signature of request to ensure that the request has not been tampered with.</li><li>Checks the authorization to ensure the corresponding account has permissions on resources.</li><li>Dispatches the request to Downloader.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="downloader-1"><a href="/greenfield-docs/docs/guide/storage-provider/modules/downloader/">Downloader</a><a class="hash-link" href="#downloader-1" title="Direct link to heading">​</a></h3><ul><li>Downloader receives the Challenge request from Gateway.</li><li>Returns all segment data checksums and challenge segment data payload to Gateway.<ul><li>Retrieve all segment data checksums from the SP DB.</li><li>Get the challenge segment data from PieceStore.</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gc-object">GC Object<a class="hash-link" href="#gc-object" title="Direct link to heading">​</a></h2><p>GC is used to delete objects whose metadata on Greenfield chain has already been deleted, reducing the cost of each SP and data size in Greenfield chain. This function is automatically executed in Manager daemon mode.</p><p>The flow chart is shown below:</p><div align="center"><img loading="lazy" src="https://raw.githubusercontent.com/bnb-chain/greenfield-docs/main/static/asset/13-gc_object.jpg" width="800" height="100" class="img_ev3q"></div><ul><li>Manager dispatches GCObjectTask to TaskExecutor.</li><li>TaskExecutor send requests to Metadata to query deleted objects in order.</li><li>TaskExecutor delete payload data which is stored in PieceStore.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gc-zombiepiece">GC ZombiePiece<a class="hash-link" href="#gc-zombiepiece" title="Direct link to heading">​</a></h2><p>GC ZombiePiece is an abstract interface to record the information for collecting the piece store space by deleting zombie pieces data that dues to any exception, the piece data meta is not on chain but the pieces have been stored in piece store, or the piece should not be stored on the correct SP node. This function is automatically executed in Manager daemon mode.</p><p>The flow chart is shown below:</p><p><img loading="lazy" alt="gc-zombie-flow" src="/greenfield-docs/assets/images/13-gc-zombie-5ab0ac9dad6e3c70c4344cb76ad42154.png" width="1612" height="838" class="img_ev3q"></p><div style="text-align:center"><i>GC ZombiePiece</i></div><ul><li>Manager dispatches GCZombiePieceTask to TaskExecutor.</li><li>TaskExecutor send requests to SPDB to query integrity meta in order.</li><li>TaskExecutor determines whether a piece is a ZombiePiece based on the IntegrityMeta table. Scans all IntegrityMeta within the current object ID range specified in GCZombiePieceTask (StartObjectId, EndObjectId).</li><li>TaskExecutor determines whether a piece is a ZombiePiece based on the PieceHash table. Scans all PieceHash within the current object ID range specified in GCZombiePieceTask (StartObjectId, EndObjectId).</li><li>TaskExecutor delete payload data which is stored in PieceStore.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="gc-meta">GC Meta<a class="hash-link" href="#gc-meta" title="Direct link to heading">​</a></h2><p>GCMetaTask is an abstract interface to record the information for collecting the SP meta store space by deleting the expired data. This function is automatically executed in Manager daemon mode.</p><p>The flow chart is shown below:</p><p><img loading="lazy" alt="gc-meta-flow" src="/greenfield-docs/assets/images/13-gc-meta-e5d241e75b2985a6cee491b9f841c332.png" width="1360" height="526" class="img_ev3q"></p><div style="text-align:center"><i>GC Meta</i></div><ul><li>Manager dispatches GCMetaTask to TaskExecutor, triggered by gcMetaTicker.</li><li>TaskExecutor send requests to SPDB to delete entries from BucketTraffic using SpDBImpl::DeleteAllBucketTrafficExpired for expired BucketTrafficTable.</li><li>TaskExecutor send requests to SPDB to delete entries from ReadRecord using SpDBImpl::DeleteAllReadRecordExpired for expired ReadRecord table.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrate-bucket">Migrate Bucket<a class="hash-link" href="#migrate-bucket" title="Direct link to heading">​</a></h2><p>Bucket user can select primary sp freely and use the migration bucket to migrate the sp service when they feel that the SP service quality is poor.</p><p>The flow chart is shown below:</p><div align="center"><img loading="lazy" src="https://raw.githubusercontent.com/bnb-chain/greenfield-docs/main/static/asset/14-bucket_migrate.jpg" width="1000" height="100" class="img_ev3q"></div><ul><li>The bucket user should ask new primary sp for migration bucket, and get the approval of the new primary SP.</li><li>The bucket user submits a MigrationBucket transaction with the approval of the new primary SP.</li><li>The dest sp subscribes event from chain, and produce migrate execute plan.</li><li>The dest sp executor fetch migrate gvg task to execute, and period report progress.</li><li>The dest sp sends the complete tx if all the gvg task are completed in execute plan.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="sp-exit">SP Exit<a class="hash-link" href="#sp-exit" title="Direct link to heading">​</a></h2><p>Greenfield allows for the participation of SPs and also allows them to exit according to their wishes.</p><p>The flow chart is shown below:</p><div align="center"><img loading="lazy" src="https://raw.githubusercontent.com/bnb-chain/greenfield-docs/main/static/asset/14-sp_exit.jpg" width="1000" height="100" class="img_ev3q"></div><ul><li>The src sp self applying for exit by sending the StorageProviderExit transaction to the blockchain.</li><li>The src sp subscribes event from chain, and produce exit execute plan.</li><li>The src sp dispatches swap out info dest sp.</li><li>The dest sp produces gvg migrate task by swap out unit.</li><li>The dest sp executor fetch migrate gvg task to execute, and period report progress.</li><li>The dest sp sends the complete swap out tx if all the gvg task are completed in swap out.</li><li>The src sp sends the complete sp exit tx if all the swap out are completed.</li></ul></div></div></div><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/bnb-chain/greenfield-docs/blob/main/docs/guide/storage-provider/introduction/workflow.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></div></article><div class="col col--12"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/greenfield-docs/docs/guide/storage-provider/introduction/overview/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/greenfield-docs/docs/guide/storage-provider/introduction/standard/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">The Greenfield Storage Provider Standard</div></a></nav></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#get-approval" class="table-of-contents__link toc-highlight">Get Approval</a></li><li><a href="#upload-object" class="table-of-contents__link toc-highlight">Upload Object</a><ul><li><a href="#gateway" class="table-of-contents__link toc-highlight">Gateway</a></li><li><a href="#uploader" class="table-of-contents__link toc-highlight">Uploader</a></li><li><a href="#taskexecutor" class="table-of-contents__link toc-highlight">TaskExecutor</a></li><li><a href="#receiver" class="table-of-contents__link toc-highlight">Receiver</a></li><li><a href="#taskexecutor-1" class="table-of-contents__link toc-highlight">TaskExecutor</a></li></ul></li><li><a href="#download-object" class="table-of-contents__link toc-highlight">Download Object</a><ul><li><a href="#gateway-1" class="table-of-contents__link toc-highlight">Gateway</a></li><li><a href="#downloader" class="table-of-contents__link toc-highlight">Downloader</a></li></ul></li><li><a href="#querymeta" class="table-of-contents__link toc-highlight">QueryMeta</a><ul><li><a href="#gateway-2" class="table-of-contents__link toc-highlight">Gateway</a></li><li><a href="#metadata" class="table-of-contents__link toc-highlight">Metadata</a></li></ul></li><li><a href="#get-challenge-piece-info" class="table-of-contents__link toc-highlight">Get Challenge Piece Info</a><ul><li><a href="#gateway-3" class="table-of-contents__link toc-highlight">Gateway</a></li><li><a href="#downloader-1" class="table-of-contents__link toc-highlight">Downloader</a></li></ul></li><li><a href="#gc-object" class="table-of-contents__link toc-highlight">GC Object</a></li><li><a href="#gc-zombiepiece" class="table-of-contents__link toc-highlight">GC ZombiePiece</a></li><li><a href="#gc-meta" class="table-of-contents__link toc-highlight">GC Meta</a></li><li><a href="#migrate-bucket" class="table-of-contents__link toc-highlight">Migrate Bucket</a></li><li><a href="#sp-exit" class="table-of-contents__link toc-highlight">SP Exit</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/greenfield-docs/assets/js/runtime~main.a785cd8e.js"></script>
<script src="/greenfield-docs/assets/js/main.3f1a059a.js"></script>
</body>
</html>