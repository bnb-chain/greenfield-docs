"use strict";(self.webpackChunkgreenfield_docs=self.webpackChunkgreenfield_docs||[]).push([[6580],{3905:(e,t,o)=>{o.d(t,{Zo:()=>p,kt:()=>m});var r=o(67294);function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function n(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function i(e,t){if(null==e)return{};var o,r,s=function(e,t){if(null==e)return{};var o,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)o=a[r],t.indexOf(o)>=0||(s[o]=e[o]);return s}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)o=a[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(s[o]=e[o])}return s}var d=r.createContext({}),l=function(e){var t=r.useContext(d),o=t;return e&&(o="function"==typeof e?e(t):n(n({},t),e)),o},p=function(e){var t=l(e.components);return r.createElement(d.Provider,{value:t},e.children)},c="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var o=e.components,s=e.mdxType,a=e.originalType,d=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=l(o),u=s,m=c["".concat(d,".").concat(u)]||c[u]||g[u]||a;return o?r.createElement(m,n(n({ref:t},p),{},{components:o})):r.createElement(m,n({ref:t},p))}));function m(e,t){var o=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var a=o.length,n=new Array(a);n[0]=u;var i={};for(var d in t)hasOwnProperty.call(t,d)&&(i[d]=t[d]);i.originalType=e,i[c]="string"==typeof e?e:s,n[1]=i;for(var l=2;l<a;l++)n[l]=o[l];return r.createElement.apply(null,n)}return r.createElement.apply(null,o)}u.displayName="MDXCreateElement"},80066:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>n,default:()=>g,frontMatter:()=>a,metadata:()=>i,toc:()=>l});var r=o(87462),s=(o(67294),o(3905));const a={title:"Storage Provider",order:2},n="Storage Provider",i={unversionedId:"guide/greenfield-blockchain/modules/storage-provider",id:"guide/greenfield-blockchain/modules/storage-provider",title:"Storage Provider",description:"Abstract",source:"@site/docs/guide/greenfield-blockchain/modules/storage-provider.md",sourceDirName:"guide/greenfield-blockchain/modules",slug:"/guide/greenfield-blockchain/modules/storage-provider",permalink:"/greenfield-docs/docs/guide/greenfield-blockchain/modules/storage-provider",draft:!1,editUrl:"https://github.com/bnb-chain/greenfield-docs/blob/main/docs/guide/greenfield-blockchain/modules/storage-provider.md",tags:[],version:"current",frontMatter:{title:"Storage Provider",order:2},sidebar:"guideSidebar",previous:{title:"Storage Module",permalink:"/greenfield-docs/docs/guide/greenfield-blockchain/modules/storage-module"},next:{title:"Billing and Payment",permalink:"/greenfield-docs/docs/guide/greenfield-blockchain/modules/billing-and-payment"}},d={},l=[{value:"Abstract",id:"abstract",level:2},{value:"Key Workflow",id:"key-workflow",level:2},{value:"Join the network",id:"join-the-network",level:3},{value:"Leave the network",id:"leave-the-network",level:3},{value:"State",id:"state",level:2},{value:"StorageProvider",id:"storageprovider",level:3},{value:"Params",id:"params",level:3},{value:"Deposit Pool",id:"deposit-pool",level:3},{value:"Message",id:"message",level:2},{value:"MsgCreateStorageProvider",id:"msgcreatestorageprovider",level:3},{value:"MsgEditStorageProvider",id:"msgeditstorageprovider",level:3},{value:"MsgDeposit",id:"msgdeposit",level:3},{value:"MsgUpdateStorageProviderStatus",id:"msgupdatestorageproviderstatus",level:3},{value:"UpdateSpStoragePrice",id:"updatespstorageprice",level:3}],p={toc:l},c="wrapper";function g(e){let{components:t,...o}=e;return(0,s.kt)(c,(0,r.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"storage-provider"},"Storage Provider"),(0,s.kt)("h2",{id:"abstract"},"Abstract"),(0,s.kt)("p",null,"The storage providers (SP) are storage service infrastructures that organizations or individuals provide and the\ncorresponding roles they play. They use Greenfield as the ledger and the single source of truth. Each SP can and\nwill respond to users' requests to write (upload) and read (download) data, and serve as the gatekeeper for\nuser rights and authentications."),(0,s.kt)("p",null,"The SP module is responsible for managing and keeping storage providers in the network. This includes:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Metadata"),": Basic information, such as address, tokens, and status, about each SP."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Deposit"),": Aspiring SPs must stake tokens to guarantee their capacity to offer storage services."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Slash"),": Stored data on an SP is occasionally challenged. If the challenge succeeds, the SP is penalized by losing some of its staked tokens."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Reputation"),": We are implementing a reputation system to assess the quality of each SP's service. Users can select an SP based on its reputation score to store their data."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("strong",{parentName:"li"},"Exit"),": SPs can leave voluntarily as long as they adhere to specific rules and recover their staked tokens. Greenfield may also force an SP to exit if it lacks sufficient staked tokens or its reputation score falls below the minimum requirements for an SP.")),(0,s.kt)("h2",{id:"key-workflow"},"Key Workflow"),(0,s.kt)("h3",{id:"join-the-network"},"Join the network"),(0,s.kt)("p",null,'SPs have to register themselves first by depositing BNB tokens on the Greenfield blockchain as their "Service Stake".\nThe validators will go through a dedicated governance procedure to vote for the SPs of their election. SPs are encouraged to\nadvertise their information and prove to the community their capability, as SPs have to provide a professional storage\nsystem with high-quality SLA.'),(0,s.kt)("p",null,"It will take several transactions to join the greenfield storage network for storage provider."),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},"The funding account of SP should grant the governance module account to deduct tokens for staking;"),(0,s.kt)("li",{parentName:"ol"},"The SP submit a ",(0,s.kt)("inlineCode",{parentName:"li"},"CreateStorageProvider")," proposal to governance module;"),(0,s.kt)("li",{parentName:"ol"},"Deposit enough BNB tokens for the proposal;"),(0,s.kt)("li",{parentName:"ol"},"The validators should either vote ",(0,s.kt)("inlineCode",{parentName:"li"},"Pass")," or ",(0,s.kt)("inlineCode",{parentName:"li"},"reject")," for the proposal;"),(0,s.kt)("li",{parentName:"ol"},"When more than half of the validators have voted, the storage provider will be automatically created on chain."),(0,s.kt)("li",{parentName:"ol"},"The SP status will be ",(0,s.kt)("inlineCode",{parentName:"li"},"STATUS_IN_MAINTENANCE")," after created, it must send a transaction to update its status to ",(0,s.kt)("inlineCode",{parentName:"li"},"STATUS_IN_SERVICE")," to activate itself.")),(0,s.kt)("h3",{id:"leave-the-network"},"Leave the network"),(0,s.kt)("p",null,'When the SPs join or leave the network, they have to follow a series of actions to ensure data redundancy for the\nusers; otherwise, their "Service Stake" will be fined. This is achieved through the data availability challenge and\nvalidator governance votes.'),(0,s.kt)("p",null,"For more information, please see ",(0,s.kt)("a",{parentName:"p",href:"/greenfield-docs/docs/guide/greenfield-blockchain/modules/virtual-group#sp-exit-workflow"},"SP exit")),(0,s.kt)("h2",{id:"state"},"State"),(0,s.kt)("h3",{id:"storageprovider"},"StorageProvider"),(0,s.kt)("p",null,"The storage provider can be in one of these several statuses:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"STATUS_IN_SERVICE"),": The SP is in service. it can serve user's Create/Upload/Download request."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"STATUS_IN_MAINTENANCE"),": The SP is in maintenance. it can not serve user's Create/Upload request. It might be able to serve Download request."),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("inlineCode",{parentName:"li"},"STATUS_GRACEFUL_EXITING"),": The SP is exiting gracefully. All the object stored in it will be shifted to another sp.")),(0,s.kt)("p",null,"The storage providers metadata should be primarily stored and accessed by the ",(0,s.kt)("inlineCode",{parentName:"p"},"OperatorAddr"),", an EIP712 account address\nfor the operator of the storage provider. Three additional indices are maintained per storage provider metadata in\norder to fulfill required lookups for SealObject/Deposit/Slash/GetApproval."),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"StorageProvider: ",(0,s.kt)("inlineCode",{parentName:"li"},"0x21 | OperatorAddr -> ProtocolBuffer(StorageProvider)")),(0,s.kt)("li",{parentName:"ul"},"StorageProviderByFundingAddress: ",(0,s.kt)("inlineCode",{parentName:"li"},"0x22 | FundingAddress -> OperatorAddr")),(0,s.kt)("li",{parentName:"ul"},"StorageProviderBySealAddress: ",(0,s.kt)("inlineCode",{parentName:"li"},"0x23 | SealAddress -> OperatorAddr")),(0,s.kt)("li",{parentName:"ul"},"StorageProviderByApprovalAddress: ",(0,s.kt)("inlineCode",{parentName:"li"},"0x24 | ApprovalAddress -> OperatorAddr"))),(0,s.kt)("p",null,"Each storage provider's state is stored in a ",(0,s.kt)("inlineCode",{parentName:"p"},"StorageProvider")," struct."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-protobuf"},'// StorageProvider defines the meta info of storage provider\nmessage StorageProvider {\n  // // id is the identifier of the storage provider, used in virtual group\n  uint32 id = 1;\n  // operator_address defines the account address of the storage provider\'s operator; It also is the unique index key of sp.\n  string operator_address = 2 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  // funding_address defines one of the storage provider\'s accounts which is used to deposit and reward.\n  string funding_address = 3 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  // seal_address defines one of the storage provider\'s accounts which is used to SealObject\n  string seal_address = 4 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  // approval_address defines one of the storage provider\'s accounts which is used to approve use\'s migrateBucket request\n  string approval_address = 5 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  // gc_address defines one of the storage provider\'s accounts which is used for gc purpose.\n  string gc_address = 6 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  // maintenance_address defines one of the storage provider\'s accounts which is used for testing while in maintenance mode\n  string maintenance_address = 7 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  // total_deposit defines the number of tokens deposited by this storage provider for staking.\n  string total_deposit = 8 [\n    (cosmos_proto.scalar) = "cosmos.Int",\n    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Int",\n    (gogoproto.nullable) = false\n  ];\n  // status defines the current service status of this storage provider\n  Status status = 9;\n  // endpoint define the storage provider\'s network service address\n  string endpoint = 10;\n  // description defines the description terms for the storage provider.\n  Description description = 11 [(gogoproto.nullable) = false];\n  // bls_key defines the bls pub key of the Storage provider for sealing object and completing migration\n  bytes bls_key = 12;\n}\n')),(0,s.kt)("h3",{id:"params"},"Params"),(0,s.kt)("p",null,"Params is a module-wide configuration structure that stores system parameters\nand defines overall functioning of the SP module."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-protobuf"},'// Params defines the parameters for the module.\nmessage Params {\n  option (gogoproto.equal) = true;\n  option (gogoproto.goproto_stringer) = false;\n\n  // deposit_denom defines the staking coin denomination.\n  string deposit_denom = 1;\n  // min_deposit defines the minimum deposit amount for storage providers.\n  string min_deposit = 2 [\n    (cosmos_proto.scalar) = "cosmos.Int",\n    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Int",\n    (gogoproto.nullable) = false\n  ];\n  // the ratio of the store price of the secondary sp to the primary sp, the default value is 12%\n  string secondary_sp_store_price_ratio = 3 [\n    (cosmos_proto.scalar) = "cosmos.Dec",\n    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",\n    (gogoproto.nullable) = false\n  ];\n  // previous blocks that be traced back to for maintenance_records\n  int64 num_of_historical_blocks_for_maintenance_records = 4 [(gogoproto.moretags) = "yaml:\\"num_of_historical_blocks_for_maintenance_records\\""];\n  // the max duration that a SP can be in_maintenance within num_of_historical_blocks_for_maintenance_records\n  int64 maintenance_duration_quota = 5 [(gogoproto.moretags) = "yaml:\\"maintenance_duration_quota\\""];\n  // the number of blocks to be wait for sp to be in maintenance mode again if already requested\n  int64 num_of_lockup_blocks_for_maintenance = 6 [(gogoproto.moretags) = "yaml:\\"num_of_lockup_blocks_for_maintenance\\""];\n  // the time interval to update global storage price, if it is not set then the price will be updated at the first block of each natural month\n  uint64 update_global_price_interval = 7 [(gogoproto.moretags) = "yaml:\\"update_global_price_interval\\""];\n  // the days counting backwards from end of a month in which a sp cannot update its price\n  uint32 update_price_disallowed_days = 8 [(gogoproto.moretags) = "yaml:\\"update_price_disallowed_days\\""];\n}\n')),(0,s.kt)("h3",{id:"deposit-pool"},"Deposit Pool"),(0,s.kt)("p",null,"The SP module uses its module account to manage all the staking tokens deposited by storage providers."),(0,s.kt)("h2",{id:"message"},"Message"),(0,s.kt)("h3",{id:"msgcreatestorageprovider"},"MsgCreateStorageProvider"),(0,s.kt)("p",null,"A storage provider is created using the ",(0,s.kt)("inlineCode",{parentName:"p"},"MsgCreateProvider")," messages."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-protobuf"},'message MsgCreateStorageProvider {\n  option (cosmos.msg.v1.signer) = "creator";\n  \n  string creator = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  Description description = 2 [(gogoproto.nullable) = false];\n  string sp_address = 3 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string funding_address = 4 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string seal_address = 5 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string approval_address = 6 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string gc_address = 7 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string maintenance_address = 8 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string endpoint = 9;\n  cosmos.base.v1beta1.Coin deposit = 10 [(gogoproto.nullable) = false];\n  string read_price = 11 [\n    (cosmos_proto.scalar) = "cosmos.Dec",\n    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",\n    (gogoproto.nullable) = false\n  ];\n  uint64 free_read_quota = 12;\n  string store_price = 13 [\n    (cosmos_proto.scalar) = "cosmos.Dec",\n    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",\n    (gogoproto.nullable) = false\n  ];\n  string bls_key = 14;\n  string bls_proof = 15;\n}\n')),(0,s.kt)("p",null,"This message is expected to fail if:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Another storage provider with this operator/seal/funding/approval address is already registered;"),(0,s.kt)("li",{parentName:"ul"},"The initial deposit tokens do not belong to the denomination that is specified as the deposit denomination of the SP module;"),(0,s.kt)("li",{parentName:"ul"},"The deposit tokens is insufficient.")),(0,s.kt)("h3",{id:"msgeditstorageprovider"},"MsgEditStorageProvider"),(0,s.kt)("p",null,"The metadata of a storage provider can be edited by using ",(0,s.kt)("inlineCode",{parentName:"p"},"MsgEditStorageProvider")," messages."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-protobuf"},'// MsgEditStorageProvider defines a SDK message for editing an existed SP.\nmessage MsgEditStorageProvider {\n  option (cosmos.msg.v1.signer) = "sp_address";\n\n  string sp_address = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string endpoint = 2;\n  Description description = 3 [(gogoproto.nullable) = false];\n  string seal_address = 4 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string approval_address = 5 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string gc_address = 6 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string maintenance_address = 7 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  string bls_key = 8;\n  string bls_proof = 9;\n}\n')),(0,s.kt)("p",null,"This message is expected to fail if:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"The storage provider is not existed."),(0,s.kt)("li",{parentName:"ul"},"The description fields are too large."),(0,s.kt)("li",{parentName:"ul"},"The bls_proof verification failed.")),(0,s.kt)("h3",{id:"msgdeposit"},"MsgDeposit"),(0,s.kt)("p",null,"When the deposit tokens of a storage provider are insufficient, it can use ",(0,s.kt)("inlineCode",{parentName:"p"},"MsgDeposit")," messages to resupply the\ndeposit tokens."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-protobuf"},'// MsgDeposit defines a SDK message to deposit token for SP.\nmessage MsgDeposit {\n  option (cosmos.msg.v1.signer) = "creator";\n\n  // creator is the msg signer, it should be SP address or sp\'s fund address\n  string creator = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  // sp_address is the operator address of sp\n  string sp_address = 2 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  // deposit is a mount of token which used to deposit for SP\n  cosmos.base.v1beta1.Coin deposit = 3 [(gogoproto.nullable) = false];\n}\n')),(0,s.kt)("p",null,"This message is expected to fail if:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"The storage provider doesn't exist;"),(0,s.kt)("li",{parentName:"ul"},"The tokens that are deposited do not belong to the denomination that is specified as the deposit denomination of the SP module.")),(0,s.kt)("h3",{id:"msgupdatestorageproviderstatus"},"MsgUpdateStorageProviderStatus"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-protobuf"},'// MsgUpdateStorageProviderStatus is used to update the status of a SP by itself\nmessage MsgUpdateStorageProviderStatus {\n  option (cosmos.msg.v1.signer) = "sp_address";\n  string sp_address = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  Status status = 2;\n  int64 duration = 3;\n}\n')),(0,s.kt)("p",null,"This message is expected to fail if:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"The storage provider doesn't exist;"),(0,s.kt)("li",{parentName:"ul"},"The status is not changed"),(0,s.kt)("li",{parentName:"ul"},"The restrictions violated")),(0,s.kt)("h3",{id:"updatespstorageprice"},"UpdateSpStoragePrice"),(0,s.kt)("p",null,"A storage provider can update its free read quote, suggested primary store price and read price. All SPs' suggested primary store and\nread prices will be used to generate the global primary/secondary store price and read price. "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-protobuf"},'// MsgUpdateSpStoragePrice defines a SDK message to update its prices of a SP.\nmessage MsgUpdateSpStoragePrice {\n  option (cosmos.msg.v1.signer) = "sp_address";\n\n  // sp address\n  string sp_address = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n  // read price, in bnb wei per charge byte\n  string read_price = 2 [\n    (cosmos_proto.scalar) = "cosmos.Dec",\n    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",\n    (gogoproto.nullable) = false\n  ];\n  // free read quota, in byte\n  uint64 free_read_quota = 3;\n  // store price, in bnb wei per charge byte\n  string store_price = 4 [\n    (cosmos_proto.scalar) = "cosmos.Dec",\n    (gogoproto.customtype) = "github.com/cosmos/cosmos-sdk/types.Dec",\n    (gogoproto.nullable) = false\n  ];\n}\n')),(0,s.kt)("p",null,"This message is expected to fail if:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"The storage provider doesn't exist;"),(0,s.kt)("li",{parentName:"ul"},"The storage provider tries to update its prices in the last ",(0,s.kt)("inlineCode",{parentName:"li"},"update_price_disallowed_days")," (default value is 2) days.")))}g.isMDXComponent=!0}}]);