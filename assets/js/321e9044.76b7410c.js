"use strict";(self.webpackChunkgreenfield_docs=self.webpackChunkgreenfield_docs||[]).push([[7209],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),m=r,k=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?a.createElement(k,i(i({ref:t},p),{},{components:n})):a.createElement(k,i({ref:t},p))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},62773:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const o={title:"Codebase Overview"},i="Data Marketplace with Programmable Access Control",l={unversionedId:"tutorials/app/data-marketplace/overview",id:"tutorials/app/data-marketplace/overview",title:"Codebase Overview",description:"Introduction",source:"@site/docs/tutorials/app/data-marketplace/overview.md",sourceDirName:"tutorials/app/data-marketplace",slug:"/tutorials/app/data-marketplace/overview",permalink:"/greenfield-docs/docs/tutorials/app/data-marketplace/overview",draft:!1,editUrl:"https://github.com/bnb-chain/greenfield-docs/blob/main/docs/tutorials/app/data-marketplace/overview.md",tags:[],version:"current",frontMatter:{title:"Codebase Overview"},sidebar:"tutorialsSidebar",previous:{title:"How to Build a DeSoc dApp On BNB Greenfield & opBNB",permalink:"/greenfield-docs/docs/tutorials/app/desoc/desoc-tutorial"},next:{title:"Simple Tool for File Management",permalink:"/greenfield-docs/docs/tutorials/app/file-management/basic-file-management"}},s={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Data Marketplace Workflow",id:"data-marketplace-workflow",level:2},{value:"Greenfield Contract SDK",id:"greenfield-contract-sdk",level:2},{value:"Ebook Data Marketplace Example",id:"ebook-data-marketplace-example",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Installation",id:"installation",level:3},{value:"Steps",id:"steps",level:4},{value:"Source Code",id:"source-code",level:2},{value:"Deployments",id:"deployments",level:2}],p={toc:c},d="wrapper";function u(e){let{components:t,...o}=e;return(0,r.kt)(d,(0,a.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"data-marketplace-with-programmable-access-control"},"Data Marketplace with Programmable Access Control"),(0,r.kt)("h2",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"BNB Greenfield introduces an entirely new structural and economic paradigm for data in the Web3 era. The ownership, usage and monetization of data is now possible first and foremost for users, as well as all participants in the BNB Chain ecosystem."),(0,r.kt)("p",null,"In this tutorial, we will learn to build a data marketplace with programmable access control."),(0,r.kt)("h2",{id:"data-marketplace-workflow"},"Data Marketplace Workflow"),(0,r.kt)("p",null,"Data marketplace is a data exchange platform where users can freely create, list, trade, and sell data assets, including digital publications, scientific experimental data, and specific domain data."),(0,r.kt)("p",null,"In this tutorial, we have to solve the question: How can Alice share/sell her private files to Bob?"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Transaction Details",src:n(82489).Z,width:"1017",height:"598"})),(0,r.kt)("p",null,"The Greenfield Blockchain offers a comprehensive set of resources, including buckets, objects, and groups, which can be mirrored on the BNB Smart Chain (BSC) as non-fungible tokens (NFTs) adhering to the ERC-721 standard. Buckets serve as logical containers for storing objects, where an object represents a fundamental storage unit containing data and metadata. Groups are collections of accounts with similar permissions. These resources, along with group members' permissions as ERC-1155 tokens, can be mirrored on the BSC. Currently, these NFTs are non-transferable but will gain transferability in the near future. Smart contracts on BSC can directly manage these mirrored resources, impacting storage formats, access permissions, and other data aspects on Greenfield. This integration enhances flexibility and accessibility, streamlining and optimizing data management across both platforms."),(0,r.kt)("p",null,"To learn more about the ",(0,r.kt)("strong",{parentName:"p"},"mirroring")," implementation details, please read ",(0,r.kt)("a",{parentName:"p",href:"/greenfield-docs/docs/guide/core-concept/cross-chain/mirror"},"this doc")),(0,r.kt)("p",null,"To solve her problem with resource mirroring, Alice should complete the following:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Transaction Details",src:n(18696).Z,width:"972",height:"568"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Create a group on Greenfield"),(0,r.kt)("li",{parentName:"ol"},"Bind group with object or bucket on Greenfield"),(0,r.kt)("li",{parentName:"ol"},"Mirror the group to BSC"),(0,r.kt)("li",{parentName:"ol"},"Approve the data marketplace smart contract to operate her group"),(0,r.kt)("li",{parentName:"ol"},"List the group on BSC data marketplace smart contract, setting price")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Transaction Details",src:n(98021).Z,width:"1026",height:"586"})),(0,r.kt)("p",null,"To access data asset from BSC"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Transaction Details",src:n(66163).Z,width:"1016",height:"576"})),(0,r.kt)("h2",{id:"greenfield-contract-sdk"},"Greenfield Contract SDK"),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/bnb-chain/greenfield-contracts-sdk"},"Smart Contract SDK"),", designed to facilitate the development of community-driven projects. The SDK serves as an upper layer wrapper for the\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/bnb-chain/greenfield-contracts"},"Greenfield-Contracts")," library, which implements the cross-chain communication functionality. By providing a user-friendly interface to the underlying interface, the SDK simplifies the development process and enables developers to create and manage a variety of greenfield resources, like bucket, group, and object on BSC through smart contract directly."),(0,r.kt)("p",null,"To learn more about the mirroring implementation details, please read ",(0,r.kt)("a",{parentName:"p",href:"/greenfield-docs/docs/guide/core-concept/cross-chain/sdk"},"this doc")," and ",(0,r.kt)("a",{parentName:"p",href:"/greenfield-docs/docs/guide/core-concept/cross-chain/interface"},"Primitive Interfaces")),(0,r.kt)("h2",{id:"ebook-data-marketplace-example"},"Ebook Data Marketplace Example"),(0,r.kt)("p",null,"We will walk you through the process of creating a decentralized ebook marketplace using the Contract SDK\nas an example."),(0,r.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"Before starting, make sure you have the following tools installed:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://nodejs.org/"},"Node.js")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://book.getfoundry.sh/"},"Foundry"))),(0,r.kt)("h3",{id:"installation"},"Installation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-console"},"$ npm install @bnb-chain/greenfield-contracts-sdk\n")),(0,r.kt)("p",null,"Alternatively, you can obtain the contracts directly from the GitHub repository (",(0,r.kt)("inlineCode",{parentName:"p"},"bnb-chain/greenfield-contracts-sdk"),"). When doing so, ensure that you specify the appropriate release."),(0,r.kt)("h4",{id:"steps"},"Steps"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Import the desired contracts, for example in ",(0,r.kt)("inlineCode",{parentName:"p"},"examples/ebook-shop.sol"),":"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-solidity"},'pragma solidity ^0.8.0;\n\nimport "@bnb-chain/greenfield-contracts-sdk/BucketApp.sol";\nimport "@bnb-chain/greenfield-contracts-sdk/ObjectApp.sol";\nimport "@bnb-chain/greenfield-contracts-sdk/GroupApp.sol";\nimport "@bnb-chain/greenfield-contracts-sdk/interface/IERC1155.sol";\nimport "@bnb-chain/greenfield-contracts-sdk/interface/IERC721NonTransferable.sol";\nimport "@bnb-chain/greenfield-contracts-sdk/interface/IERC1155NonTransferable.sol";\n...\n\ncontract EbookShop is BucketApp, ObjectApp, GroupApp {\n    ...\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Define the ",(0,r.kt)("inlineCode",{parentName:"p"},"initialize")," function. Initialize the global variables in the init function. You can use the internal init functions:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-solidity"},"function initialize(\n    address _crossChain,\n    address _bucketHub,\n    address _objectHub,\n    address _groupHub,\n    address _ebookToken,\n    address _paymentAddress,\n    uint256 _callbackGasLimit,\n    address _refundAddress,\n    uint8 _failureHandleStrategy,\n    ...\n) public initializer {\n    __base_app_init_unchained(_crossChain, _callbackGasLimit, _refundAddress, _failureHandleStrategy);\n    __bucket_app_init_unchained(_bucketHub);\n    __group_app_init_unchained(_groupHub);\n    __object_app_init_unchained(_objectHub);\n\n    ...\n}\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Define and override the ",(0,r.kt)("inlineCode",{parentName:"p"},"greenfieldCall"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"retryPackage")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"skipPackage")," functions if your dApp needs callback. You can route calls with the help of the internal method:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-solidity"},'function greenfieldCall(\n    uint32 status,\n    uint8 resoureceType,\n    uint8 operationType,\n    uint256 resourceId,\n    bytes calldata callbackData\n) external override(BucketApp, ObjectApp, GroupApp) {\n    require(msg.sender == crossChain, string.concat("EbookShop: ", ERROR_INVALID_CALLER));\n\n    if (resoureceType == RESOURCE_BUCKET) {\n        _bucketGreenfieldCall(status, operationType, resourceId, callbackData);\n    } else if (resoureceType == RESOURCE_OBJECT) {\n        _objectGreenfieldCall(status, operationType, resourceId, callbackData);\n    } else if (resoureceType == RESOURCE_GROUP) {\n        _groupGreenfieldCall(status, operationType, resourceId, callbackData);\n    } else {\n        revert(string.concat("EbookShop: ", ERROR_INVALID_RESOURCE));\n    }\n}\n\nfunction retryPackage(uint8 resoureceType) external override onlyOperator {\n    if (resoureceType == RESOURCE_BUCKET) {\n        _retryBucketPackage();\n    } else if (resoureceType == RESOURCE_OBJECT) {\n        _retryObjectPackage();\n    } else if (resoureceType == RESOURCE_GROUP) {\n        _retryGroupPackage();\n    } else {\n        revert(string.concat("EbookShop: ", ERROR_INVALID_RESOURCE));\n    }\n}\n\nfunction skipPackage(uint8 resoureceType) external override onlyOperator {\n    if (resoureceType == RESOURCE_BUCKET) {\n        _skipBucketPackage();\n    } else if (resoureceType == RESOURCE_OBJECT) {\n        _skipObjectPackage();\n    } else if (resoureceType == RESOURCE_GROUP) {\n        _skipGroupPackage();\n    } else {\n        revert(string.concat("EbookShop: ", ERROR_INVALID_RESOURCE));\n    }\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Next you need to define the main functional parts of the app. You can send cross-chain request to system contracts with the help of internal functions like below:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-solidity"},'/**\n * @dev Create a new series.\n *\n * Assuming the sp provider\'s info will be provided by the front-end.\n */\nfunction createSeries(\n    string calldata name,\n    BucketStorage.BucketVisibilityType visibility,\n    uint64 chargedReadQuota,\n    address spAddress,\n    uint256 expireHeight,\n    bytes calldata sig\n) external payable {\n    require(bytes(name).length > 0, string.concat("EbookShop: ", ERROR_INVALID_NAME));\n    require(seriesId[name] == 0, string.concat("EbookShop: ", ERROR_RESOURCE_EXISTED));\n\n    bytes memory _callbackData = bytes(name); // use name as callback data\n    _createBucket(msg.sender, name, visibility, chargedReadQuota, spAddress, expireHeight, sig, _callbackData); // send cross-chain request\n}\n\n/**\n * @dev Provide an ebook\'s ID to publish it.\n *\n * An ERC1155 token will be minted to the owner.\n * Other users can buy the ebook by calling `buyEbook` function with given price.\n */\nfunction publishEbook(uint256 _ebookId, uint256 price) external {\n    require(\n        IERC721NonTransferable(objectToken).ownerOf(_ebookId) == msg.sender,\n        string.concat("EbookShop: ", ERROR_INVALID_CALLER)\n    );\n    require(ebookGroup[_ebookId] != 0, string.concat("EbookShop: ", ERROR_GROUP_NOT_EXISTED));\n    require(price > 0, string.concat("EbookShop: ", ERROR_INVALID_PRICE));\n\n    ebookPrice[_ebookId] = price;\n    IERC1155(ebookToken).mint(msg.sender, _ebookId, 1, "");\n}\n\n/**\n * @dev Provide an ebook\'s ID to buy it.\n *\n * Buyer will be added to the group of the ebook.\n * An ERC1155 token will be minted to the buyer.\n */\nfunction buyEbook(uint256 _ebookId) external payable {\n    require(ebookPrice[_ebookId] > 0, string.concat("EbookShop: ", ERROR_EBOOK_NOT_ONSHELF));\n\n    uint256 price = ebookPrice[_ebookId];\n    require(msg.value >= price, string.concat("EbookShop: ", ERROR_NOT_ENOUGH_VALUE));\n\n    IERC1155(ebookToken).mint(msg.sender, _ebookId, 1, "");\n\n    uint256 _groupId = ebookGroup[_ebookId];\n    address _owner = IERC721NonTransferable(groupToken).ownerOf(_groupId);\n    address[] memory _member = new address[](1);\n    _member[0] = msg.sender;\n    _updateGroup(_owner, _groupId, UPDATE_ADD, _member);\n}\n\n/**\n * @dev Provide an ebook\'s ID to downshelf it.\n *\n * The ebook will be removed from the shelf and cannot be bought.\n * Those who have already purchased are not affected.\n */\nfunction downshelfEbook(uint256 _ebookId) external {\n    require(\n        IERC721NonTransferable(objectToken).ownerOf(_ebookId) == msg.sender,\n        string.concat("EbookShop: ", ERROR_INVALID_CALLER)\n    );\n    require(ebookPrice[_ebookId] > 0, string.concat("EbookShop: ", ERROR_EBOOK_NOT_ONSHELF));\n\n    ebookPrice[_ebookId] = 0;\n}\n...\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Besides, you may need to provide a function for user to register their own resource that were created at greenfield side and then mirrored to BSC manually:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-solidity"},'/**\n * @dev Register bucket resource that mirrored from GreenField to BSC.\n */\nfunction registerSeries(string calldata name, uint256 tokenId) external {\n    require(\n        IERC721NonTransferable(bucketToken).ownerOf(tokenId) == msg.sender,\n        string.concat("EbookShop: ", ERROR_INVALID_CALLER)\n    );\n    require(bytes(name).length > 0, string.concat("EbookShop: ", ERROR_INVALID_NAME));\n    require(seriesId[name] == 0, string.concat("EbookShop: ", ERROR_RESOURCE_EXISTED));\n\n    seriesName[tokenId] = name;\n    seriesId[name] = tokenId;\n}\n...\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Define other view functions, internal functions and access control system according to your own needs."))),(0,r.kt)("h2",{id:"source-code"},"Source Code"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Frontend: ",(0,r.kt)("inlineCode",{parentName:"li"},"https://github.com/bnb-chain/greenfield-data-marketplace-frontend")),(0,r.kt)("li",{parentName:"ul"},"Smart Contracts: ",(0,r.kt)("inlineCode",{parentName:"li"},"https://github.com/bnb-chain/greenfield-data-marketplace-contracts"))),(0,r.kt)("h2",{id:"deployments"},"Deployments"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://marketplace.greenfield-sp.bnbchain.org/index.html"},"Data Marketplace BSC Mainnet Demo")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://marketplace.greenfield-sp.bnbchain.org/bsc-testnet.html"},"Data Marketplace BSC Testnet Demo")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://marketplace.greenfield-sp.bnbchain.org/opbnb-testnet.html"},"Data Marketplace opBNB Testnet Demo"))))}u.isMDXComponent=!0},82489:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/datamarketplace-1-df9f748af0fd0b3ae10117952e922ffd.png"},18696:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/datamarketplace-2-6ad90ee73025de22cfe51a3471ac5cac.png"},98021:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/datamarketplace-3-d89b2537e7783e7915af24938d76d3ea.png"},66163:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/datamarketplace-4-55d2c2eea3042f4ef12b62cb7b61e41f.png"}}]);